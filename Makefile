#
# small makefile to patch agvtool into mulle-agvtool
# just say make
#
# Coded 2014 by Nat!
# ====================
# www.mulle-kybernetik.com
#
# This makefile will regenerate itself, when changes to mulle-agvtool
# have been made
#
XCODE:=$(shell xcode-select -p)
AGVTOOL:=$(XCODE)/usr/bin/agvtool

PATCHSTRING:=QlpoOTFBWSZTWe3ELTwACWvfgG/7f///////////////YBI/ebgN9HvE7rzpbDgc51um94C7XUEkkqkvI03LgdazbWso2ddWa2r3eGQiaKn6aFMaj8o0JiG0CbKGmRptQDEw1MjAnqZMAT1MMQgTQI0mVT/RKb1G1GnqjaeqeTU9QAHoh5Q0DIGagGmRg4ABoNDQaADTINDIGmgAAMgAyAyAAk0okQp6RhkjGk9E0yaPSZqAAAMjRkBoNAANMgRKITTTFPQTSaGTU9KfpT1PCh6npqaeiGjQGg09I9IAeoD0hoIlE1MgCCntGRNManqAmo8p5TQ8UaZAepoekaPKAPUA9Q2mhAkUckWRGRQHoIABRCPOQClQpzEqNw3Fa1cYRLhVVoUO6JQYBHCVRRiAoIlYWlCqgQIgczA3T/pB4hZSJc2Lfeq8jC9YhFEIVXQF345d1nyz1ylGOfspwnX4a/P8V5j5Dg/9KABqtCiQlGiG0qQKaXq2IuEtGsgKb2rq8QbU8ThIRY5JnYMAgZnwyaMgxZxxbuoKhIcGmnClvA5s/8RNhggypJNBEdEgJGQrtMSRoJKvk3zw8NHvxtnt0t54nNuSbdPDW6QfhydTaYXX6hPrrsSQAYuEF24mumL2hmED6t9YM/W16RKsxSx+NBlLk3Y46fYjqwwzxQy49IllIBpMeq1XEBJS6NqvgFOeCEIRuu+V1XOglOrzqH5VaQ4LB2U1p8F6DnakIScAE5FJ9oBGGEBGCrAgweZ56YWZ8eu65LUAQMYBegXg4FQU3aV8WWKI1UTWEIWkVVRsCS1trYSHs5DlbC0VNjciSaFhPEfBPzlhoe93qHJJ5hczNP4wUtP5wVeVsYNNOt1ZND4UsxKQC0S5YcQl7t25JtNtK9eXVUu9+IK5RjgzEN0iYiUAsGwUZo8levTK3qVaW5Y0h7NX06qhdZTrsuuEitLBHoBJBY5xN26RJM/jxL5KJ5lrl5Q0HFnIcFJmEcjyAgJcFsGjNk8z58vOYIhGhg1Kgxninz0Y+wBpkuEHwBX2FS3HgoH5zaGNKg9XVLpwHX2a7iu6gFpXuUL5Ty9+vaN2wh/jy05/PaeggbRmTvHMVLJQOszsD35UM+qvhMcORQcC7I6dPcCkkJ5DxN/uazVv02zd4fQHf1T00UIoKCwolVAeMGvkTm5NOFzjOicvlT7FHANKWEam7do8T4vFno5PdZo7n0EZDOj2cUoJZ+Os3EzKuvSIOmGbzHvn7+wvsvsccwZSsdTqM7bjTw2nkf/6i5EePwDnCCH1OTY972SgMiNYN3KFJXESXbQl9ShXu820s2gEgQ2570uaZxnPL7bc/TBmT1V3DPq25S3TyCMRoSAUXOUOXwQHX3q3mduIWmA/9KDwa++lfroOpIhj2d+FsAx67tmlx4AZjJwseXep8gDSEgJREIQ7E86cz8JnxzYvIv85b5NvaM5QLCxiVwKG46F8+57jzxHabOyu9jTyXf1vudbeK3C/kGHdfwSxFXk4Cg+e4gWUZ4e3fSuV/TlbCtJteGC552F1GhBQzXA+YXCHo3cYmwSBo7iQo3Wd/elC1YGKAUcNsGPjQIDhxgHFfNdW8vtdPZp6inJZIVqw12a7/GJwobwyaB4q21OqQ9KYe6if6v7SRD1os3nncMskw5pNJgUoidj5DGNKSoytYAUKXsfHnJDXoGAXg/yaBppJYcjc3enoaOywRlZdYXBLZKMKUI3BUh7uQzIjPbZ2k4twYaVpV7kNqHUdozMTESUwruKmZMWldkQwIPtpqJOXmBhRQYdoggWDadOZJmQwibFkA4GSoYYETFprGIWbFDN+zyB/543yHT4jDpHvuOjbSHMUfLifEFhGyMCIzRQQo1amj5PNLvZU8OP3Jf9fYFCAJg78mAkcoC0YyRiMYxCCekESp1UWSiARPsutxwdyHB2D0tj2zaO7b0eUN6CO/3/1JTTUT1dqUpSUMpJ6znETEOIZ3VbLpqtjgObuUHr4PQlK567TA92iWRBsIn8TAs8f30tK1qh7vEUG1mg7OolC+yElBqxpBQJz8FNMIo4xOyc4nX3NfZ1b/Dg1uhxcHPEyTDRua2PmOongjDu0KB0PmC4G8HCPzuWxDPrcrid3R2uynWQruM9cgDnHfdgG/hWIYsz3TiNTmw4p5zu+XlAOK4EW4qc/x+9f3nc03g3frDmMStiwyZQDzDQExr3+dcrSOC+3tcJXV2GEGC2lBS1ju1n03U4qx+L3mDLKGAYer3OiggiEOA5k28Fdba7237lYdlVRFihLt6XJjBgJnhheYnOcRFJSqIjYm53sXO9EZYh95QQocs+fOm6YDRoL9szv8YW/fs9N2kokmbm4dxltUDQhg2ygDRHYwi/PfUEYYrGGaXDDkzxJTbSjRroAIAyKM7KVehuAthdmCEMoaG0wssOTm8Qqxho0CI02GQtAkndnVGDZY0BAsiRVM6zlgLZTre4sr2k1Ylc0rhakK+VZccIrXFk07vVNemEIK6BlCUhkZSeSy2fzn64nhvqs2KcOohKoAAdFAT6MzGB5XgBouxbC4n0EhB+okIEISEGCmn3c9xXvfahed/YePm/Qeita2X/K4gUB0LEIDuM8fz1WIcF4mn1nxUIvoW4rRQqvjPaKtlX5lXzHE5IYhk/j/IUbVSxHgbE+58f5pKF7IT3iiT2CHuU9iHhH2vvOM8Ed9P+CH0P+TX3wtgYwSmsO2YmL4vwg0IWhw4A9tqiPY3TaUIS64rEgbMFi2wm6UvAob1Ln1q2EMDYjVv7nYOgUj0YcowIf5KP+hBgGsvcDtu15HYgbGq3jo+0cliA+VW8wVNjgNLmgVJgLrgFvvyZOgJrQsQ38JdnXoTQJFSN5mhochsQ6zmyDyvA8QA4xwQqWXSIOUzWjM5I849LHpNZrQvQq/FkQxuXjy1kIUxJQM6OGtgpzOZgjuOB3/ZJTHFVuzSL2piIbEhN7kjs6f7dhQEvyNSFMg7+QWNMRMQQucoCETv3r6SpcOsOVXkKYtYg2Q2I50N+aiKc6HCPShgwyAenqwQ2KbO2roGkQ22NEcWQKQKKQQPl21w1PMMLh8O92rio5oXByiDY1W9ACx40shIDTfC+wLCLegXoS1QB3K8iGY0SQIXWbEHTt8oB9OsA26S8Ju7g5ni1AZVghVDEGxDa0GJGQm4xzJJfyMGFxiQALzQ2OAIdR4ODgdH4K16n1cNHOuG68JC/VHsHBHKRskJCEIxGsNENYhvTnAO6qYPj5cVeU+oPWfK/TfQBtkTY0ArPDQDxpnVAr3fRSRlH28D6rYn9Q64c3LQPp+jFInJEP1g0MYaEJGEkQ5haBuFhtgQYj+0Pz0/2oXA/eYGYXz4SSSOZMb0zUHwnt+Y93pXLx3Pg9X2hxgvUwHvQKjSNF78TRT8btDrTWQhF7yn3CEN/fN55IFnemogaggZ4ICMekTMG62atQgqdj1dYaNLTvSQTo9zhkJ2yb0A7Z5GZD6xJ8/NO6622m+SB0+conSnQZ+5+3cGdDiGfKB1ZchCYJwoHtuGriYDtgGL3re9JBDu3F0cpA/SpNHwHfurfmYPOB++PGGfTn95e508Py/e9HIWA5R/uevrG4tDqpwbpCcZpuaEsQNT6R+dzA6Lbi51CrYB2/gFw5CGPx8dMEDgigaYEIt5I13hUkKNNmizbNQ2qfWqGfXrCg/YbwSjzECavwhgE3PSmu3mFikuL0KGMGNwJjm7+7XodKb02Nll6mkTyqcCJGjhWI5oBBAZQBfHAo0LXlSxYdk8gbzJoXMDFgIAAcoTQaoDDmAL7cOHQ7B/zFkGFcYMd/l3LqKXS6nCRO/Zqhxw2p4CTiEZM1XPPjD6Lua44ldqaPNdkVfm3O13krz3Ijj2ntOUNM6gfPyjeu9u0JGDAT1SRAkYSAEC3YYdIXW8cjLIvArYxclJXsjxD4OQQNfhOBxgVsDBF0A6nsBHdCPyUeYv+TDuYgUp3GkiUQrSNJW0LLewcxbGyDjylA2IeFuCEQkUh8L+VqgFVYk1NDnzL5mSut0tfoMRfheGNeXnDzp3mnYOV+zWMWFrQuLgRtYI3IQKgVuQXpAKtod486CX1s2OSBymnJm5DjJ42c5jyrdDCYbqh0aYwl1U0yWi4nYhg+QoGdLBfIOliVA63R2zrcDrhvLEKQN9FGmdoJS8FhACEBIxgHcHRHfiDNJJwovezDEK0jNoRMfz6juolkmp59TMWQ2Z1ZOySMM6CacS88pcYpMFGDAE44dhyyH8mB26stahxBPFnbdR2F2FwFEWYHmuGiYrnRBbYWA1GN3ppv1AYjItgyqGFwaqgUy4pEhYBqpY1qJ3pggdBFAsDKSeEMy4EBGCgMjDLJKR5iAM7MLV+Kjpb5dWFBsYpTx5OmpowgJeBe/AavTElBTUVK0vTGxVcazBQjGgpqd0A40xpQsZb2JFphK11hTies2SRI4NAU6hiSyd+WFdbBrSg9vydugevpU2BoHOia0ZcJoC4RRMQ4qcKBChioZL8wdPx+molcAxsC+aVK7nhXiALjgMY4gLmtBOfPcG+9tu8eb0hgc1Qg8hwTYaKaB+pOBT1bE8Pbw2DE7B3IM03qMyOry1U2zHA8M6qWb0Q9qbdk3NuHL5OXXkKR2QN9c4HtcLbrAtY3huWd/wrQ8Fw3PTZ683ZAXiJR1KYh4uF+GbehjFPcrfaqhgsgEXDBgeGoiZ83RSB6qSk6RYXb6yiEmah3dxOVqWh3qQoDTjNZMdydZ5V1GmccQLnXuA3C26SrGjMQHJ6Q1nmCGQDhIYZTBatTT0vnn3cma68OrXmoBpYvOpZty3MII25r6Fr5nK3jc5VOBuONe0PNGOXnPjonGtXoqh0cnFxt+lxVM2U32LWRUXPFzYyqBQ4Qe0JVsFcABGYKRAFIJU5piOjY8bcfX4vIXsTvGIywBjQChJOKABDmmubysQmup1yMNozUL1rHEdjTyIGYuhamgtyeSzy0uHOUzuJQOAp5T89gHA9s1QK7h1AWqd5gHrBMlUrYhmM55dfiW+yyLOq/SYBdpeHhutb1uvBa0oECgwiRYH1o6uHIpyrwXPEjAAvR54kh8sDUkdVkDmJmGCPE26OXgaggwiewieU8wKeqIg1IlYUf/ERSZANHmCNbcHfgSDftjJQnkCBELEX6DDORbYwidKXR50pjJUjFT/fTtSdpxALSIsAicsLD31jkTFTSiKgG3c6OHZzRGQ686nWP/F3JFOFCQ7cQtPA=
SHASUM:=e7b6e549ccdbcd24f512f597254532928101ff95

GZIP:=bzip2

.PHONY: clean

all:	mulle-agvtool mulle-agvtool.diff
	@ NEWSHASUM="$(shell shasum mulle-agvtool | awk '{ print $$1 }')" ; if [ "$$NEWSHASUM" != "$(SHASUM)" ] ; then NEWPATCHSTRING=$(shell diff -u "$(AGVTOOL)" mulle-agvtool | $(GZIP) -9 | base64 ); mv Makefile Makefile.bak ; cat Makefile.bak | sed "s|^PATCHSTRING:=.*|PATCHSTRING:=$$NEWPATCHSTRING|" | sed "s|^SHASUM:=.*|SHASUM:=$$NEWSHASUM|" > Makefile; echo "Makefile updated" ; fi 

install:	all
	install -S -m 755 mulle-agvtool /usr/local/bin

mulle-agvtool:	$(AGVTOOL) 
	cp $< $@
	chmod 755 $@
	echo $(PATCHSTRING) | base64 -D | $(GZIP) -d -c | patch $@ 

# this is used so one can look at the changes in git
# more easily 

mulle-agvtool.diff:	$(AGVTOOL) mulle-agvtool
	- diff "$(AGVTOOL)" mulle-agvtool > mulle-agvtool.diff

clean:	
	@- rm mulle-agvtool 2> /dev/null
	@- rm Makefile.bak 2> /dev/null
	@- echo "cleaned"
